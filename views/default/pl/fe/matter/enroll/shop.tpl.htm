<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,user-scalable=no,initial-scale=1.0" name="viewport">
    <base href="/" />
    <title>登记活动——新建</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/tms.css?_=2" rel="stylesheet">
    <link href="<?php echo auto_version('/static/css/pl.fe.css');?>" rel="stylesheet">
    <link href="<?php echo auto_version('/views/default/pl/fe/matter/enroll/shop.css');?>" rel="stylesheet">
</head>

<body ng-controller='ctrlMain' ng-cloak class='ng-cloak'>
    <div class='pl-layout'>
        <!--logo+侧边栏-->
        <div class='pl-layout-leftnav'>
            <!--logo-->
            <div class='pl-layout-leftnav-header'>
                <a href='/rest/home' target='_self'>
                    <?php echo APP_TITLE;?>
                </a>
            </div>
            <!--侧边栏-->
            <ul class="nav nav-tabs nav-stacked">
                <li ng-class="{'active':source==='platform'}"><a href='' ng-click="switchSource('platform')">系统模板</a></li>
                <li ng-class="{'active':source==='share'}"><a href='' ng-click="switchSource('share')">共享模板</a></li>
                <li class='hide' ng-class="{'active':source==='file'}"><a href='' ng-click="switchSource('file')">导入文件</a></li>
            </ul>
        </div>
        <!--导航+主体内容-->
        <div class='pl-layout-main pl-layout-main-topnav'>
            <nav class="navbar pl-navbar-default pl-navbar-fixed-top">
                <div class='container-fluid'>
                    <nav class='nav navbar-nav tms-breadcrumb'>
                        <li><a href="/rest/pl/fe?view=main&scope=activity&type=enroll&sid={{site.id}}" target='_self'>个人工作台</a></li>
                        <li ng-if="result.proto.mission"><a href="/rest/pl/fe/matter/mission?site={{site.id}}&id={{result.proto.mission.id}}" target='_self' title="{{result.proto.mission.title}}">{{result.proto.mission.title}}</a></li>
                    </nav>
                </div>
            </nav>
            <div class='container-fluid'>
                <div class="row">
                    <div class='col-md-12' ng-switch on="source">
                        <!-- platform -->
                        <div id='platformBoard' ng-switch-when="platform" ng-controller="ctrlSysTemplate">
                            <div class='row'>
                                <!--props-->
                                <div class='col-md-6'>
                                    <div class='panel panel-default'>
                                        <div class='panel-body'>
                                            <div class='row'>
                                                <div class='col-md-6'>
                                                    <div class='form-group'>
                                                        <label>场景</label>
                                                        <select class='form-control' ng-disabled="fixedScenario" ng-model='result.scenario' ng-options='s as s.title for s in templates2' ng-change='chooseScenario()'></select>
                                                        <p class='help-block' ng-bind="result.scenario.description"></p>
                                                    </div>
                                                </div>
                                                <div class='col-md-6'>
                                                    <div class='form-group'>
                                                        <label>模板</label>
                                                        <select class='form-control' ng-model='result.template' ng-options='t.title for t in result.scenario.templates' ng-change='chooseTemplate()'>
                                                        </select>
                                                        <p class='help-block' ng-bind="result.template.description"></p>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class='form-group'>
                                                <label>活动名称</label>
                                                <input class='form-control' ng-model='proto.title'>
                                            </div>
                                            <div class='form-group'>
                                                <label>活动说明</label>
                                                <textarea class='form-control' ng-model='proto.summary'></textarea>
                                            </div>
                                            <div class='row'>
                                                <div class='col-md-6'>
                                                    <div class='form-group'>
                                                        <label>开始时间</label>
                                                        <tms-datepicker class='tms-datepicker' tms-title='开始时间' tms-date='proto.start_at' tms-state='start_at'></tms-datepicker>
                                                    </div>
                                                </div>
                                                <div class='col-md-6'>
                                                    <div class='form-group'>
                                                        <label>结束时间</label>
                                                        <tms-datepicker class='tms-datepicker' tms-title='结束时间' tms-date='proto.end_at' tms-state='end_at'></tms-datepicker>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class='form-group' ng-if="proto.mission">
                                                <label>所属项目</label>
                                                <input class='form-control' title="{{proto.mission.title}}" value="{{proto.mission.title}}" readonly>
                                            </div>
                                            <hr>
                                            <div class='form-group'>
                                                <label>参与用户</label>
                                                <div class='radio'>
                                                    <label>
                                                        <input type='radio' value='member' ng-model="entryRule.scope" ng-change="changeUserScope()">限通讯录联系人参与 <span class='glyphicon glyphicon-question-sign' uib-tooltip='通讯录支持自定义用户信息并提供审核机制，并且可以在不同活动中重复使用'></span> <span class='badge' ng-repeat="mschema in entryRule.mschemas">{{mschema.title}} <i class='glyphicon glyphicon-remove' ng-click="removeMschema(mschema)"></i></span> <a ng-if="entryRule.scope==='member'" href='' ng-click="chooseMschema()">添加</a></label>
                                                </div>
                                                <div class='radio' ng-if="proto.mission">
                                                    <label>
                                                        <input type='radio' value='group' ng-model="entryRule.scope" ng-change="changeUserScope()">限分组活动<span ng-if="entryRule.group">【{{entryRule.group.title}} - {{entryRule.group.round.title}}】</span>用户参与 <span class='glyphicon glyphicon-question-sign' uib-tooltip='指定同项目中的分组活动中的某个分组的用户参与。'></span> <a ng-if="entryRule.scope==='group'" href='' ng-click="chooseGroupApp()">指定</a></label>
                                                </div>
                                                <div class='radio' ng-if="snsNames.length===1">
                                                    <label>
                                                        <input type='radio' value='sns' ng-model="entryRule.scope" ng-change="changeUserScope()">限公众号【{{sns[snsNames[0]].title}}】关注用户参与 <span class='glyphicon glyphicon-question-sign' uib-tooltip='可以获得用户昵称和头像（需要用户授权）。系统持久记录填写终端和填写记录间的对应关系，适用于填写后不需要查询和修改的情况。'></span></label>
                                                </div>
                                                <div class='radio' ng-if="snsNames.length>1">
                                                    <label>
                                                        <input type='radio' value='sns' ng-model="entryRule.scope" ng-change="changeUserScope()">限公众号关注用户参与 <span class='glyphicon glyphicon-question-sign' uib-tooltip='可以获得用户昵称和头像（需要用户授权）。系统持久记录填写终端和填写记录间的对应关系，适用于填写后不需要查询和修改的情况。'></span>
                                                        <span ng-if="entryRule.scope==='sns'">
                                                        <label ng-repeat="snsName in snsNames">
                                                            <input type='checkbox' ng-model="entryRule.sns[snsName]"> {{sns[snsName].title}} </label>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class='radio'>
                                                    <label>
                                                        <input type='radio' value='none' ng-model="entryRule.scope">不限制 <span class='glyphicon glyphicon-question-sign' uib-tooltip='用户可以使用手机、PC机上的微信或浏览器等终端参与活动，系统不持久记录填写终端和填写记录间的对应关系，适用于填写后不需要查询和修改的情况'></span></label>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class='form-group'>
                                                <label>其他设置</label>
                                                <div class='checkbox'>
                                                    <label>
                                                        <input type='checkbox' ng-true-value="'Y'" ng-false-value="'N'" ng-model="proto.can_repos">开放共享页 <span class='glyphicon glyphicon-question-sign' uib-tooltip='设置后参与活动的用户可以查看活动中其他用户提交的数据。可查看的题目需设置为【共享内容】'></span></label>
                                                </div>
                                                <div class='checkbox'>
                                                    <label>
                                                        <input type='checkbox' ng-true-value="'Y'" ng-false-value="'N'" ng-model="proto.can_rank">开放排行页 <span class='glyphicon glyphicon-question-sign' uib-tooltip='设置后参与活动的用户可以查看提交记录数、发表评论数、得分和积分等数据的个人或分组排行情况'></span></label>
                                                </div>
                                                <div class='checkbox'>
                                                    <label>
                                                        <input type='checkbox' ng-true-value="'Y'" ng-false-value="'D'" ng-model="result.scenarioConfig.can_rounds">按轮次登记 <span class='glyphicon glyphicon-question-sign' uib-tooltip='支持按轮次进行数据登记，每个轮次可以指定开始和结束时间'></span></label>
                                                </div>
                                            </div>
                                            <hr>
                                            <div ng-if="entryRule.scope!=='group'">
                                                <div class='form-group' ng-if="!proto.groupApp">
                                                    <button class='btn btn-default btn-block' ng-disabled="!proto.mission" ng-click="assignGroupApp()">指定分组匹配名单 <span class='glyphicon glyphicon-question-sign' uib-tooltip='指定同一个项目中的分组活动后，用户填写数据时需要提供和分组活动中匹配分组信息，例如：组号等，系统支持按照分组提交记录进行筛选和记分等功能'></span></button>
                                                </div>
                                                <div class='form-group' ng-if="proto.groupApp">
                                                    <div class="input-group">
                                                        <input class='form-control' title="{{proto.groupApp.title}}" value="{{proto.groupApp.title}}" readonly>
                                                        <div class="input-group-btn">
                                                            <button class="btn btn-default" ng-click="proto.groupApp=null">
                                                                <span class='glyphicon glyphicon-remove'></span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class='form-group' ng-if="!proto.enrollApp">
                                                <button class='btn btn-default btn-block' ng-disabled="!proto.mission" ng-click="assignEnrollApp()">指定登记匹配名单 <span class='glyphicon glyphicon-question-sign' uib-tooltip='指定同一个项目的登记活动后，用户填写数据时需要提供和登记活动中匹配信息'></span></button>
                                            </div>
                                            <div class='form-group' ng-if="proto.enrollApp">
                                                <div class="input-group">
                                                    <input class='form-control' value="{{proto.enrollApp.title}}" title="{{result.proto.enrollApp.title}}" readonly>
                                                    <div class="input-group-btn">
                                                        <button class="btn btn-default" ng-click="proto.enrollApp=null">
                                                            <span class='glyphicon glyphicon-remove'></span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class='form-group'>
                                        <button class="btn btn-success btn-block" ng-click="doCreate()"><span class='glyphicon glyphicon-plus'></span> 确定创建活动</button>
                                    </div>
                                </div>
                                <!--end:prop-->
                                <!--template-->
                                <div class='col-md-6' id='simulator'>
                                    <ul class='nav nav-pills nav-stacked pl-workspace'>
                                        <li ng-class="{'active':p===result.selectedPage}" ng-repeat="p in pages"><a href='' ng-click="choosePage(p)">{{p.title}}</a></li>
                                    </ul>
                                    <div class='text-center'>
                                        <iframe src=''></iframe>
                                    </div>
                                </div>
                                <!--end:template-->
                            </div>
                        </div>
                        <!-- end platform -->
                        <!-- share -->
                        <div id='shareBoard' ng-switch-when="share" ng-controller="ctrlUserTemplate">
                            <div class='text-right'>
                                <button class="btn btn-default navbar-btn" ng-click="doCreate()"><span class='glyphicon glyphicon-plus'></span> 确定创建活动</button>
                            </div>
                            <div class='row'>
                                <div class='col-md-12'>
                                    <div class='form-inline'>
                                        <div class='form-group' style='margin-bottom:15px'>
                                            <label class='radio-inline'>
                                                <input type='radio' name='templateScope' value='P' ng-model='criteria.scope' ng-change='searchTemplate()'>平台模板</label>
                                            <label class='radio-inline'>
                                                <input type='radio' name='templateScope' value='S' ng-model='criteria.scope' ng-change='searchBySite()'>团队模板</label>
                                            <label class='radio-inline'>
                                                <input type='radio' name='templateScope' value='U' ng-model='criteria.scope' ng-change='searchShare2Me()'>共享给我的模板</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class='row'>
                                <div class='col-md-4' ng-repeat='t in templates'>
                                    <div class='thumbnail'>
                                        <label class='radio-inline'>
                                            <input type='radio' name='template' value='{{$index}}' ng-model='data.choose' ng-change='choose(t)'><span ng-bind='t.title'></span></label>
                                        <div ng-bind='t.summary'></div>
                                        <div>需要支出积分：<span ng-bind='t.coin'></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end share -->
                        <!-- share -->
                        <div id='fileBoard' ng-switch-when="file">
                            <div class='row'>
                                <div class='col-md-6 col-md-offset-3'>
                                    <div class='panel panel-default'>
                                        <div class='panel-body'>
                                            <div class='form-group'>
                                                <button id="btnCreateByExcel" class='btn btn-default'>选择Excel文件创建活动</button>
                                                <p class='help-block'>仅支持Excel2007格式（xlsx）的文件</p>
                                            </div>
                                            <div class='form-group'>
                                                <label>选择从其他活动导出活动定义文件创建活动</label>
                                                <input type="file" class='form-control' onchange="chooseFile(this.files[0])">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end file -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/ng-template" id="chooseGroupApp.html">
        <div class="modal-header">
            <button class="close" ng-click="cancel()">×</button>
            <h5 class="modal-title">分组活动</h5>
        </div>
        <div class="modal-body">
            <form class="form-horizontal">
                <div class='form-group'>
                    <label class="col-md-3 control-label">目标活动</label>
                    <div class="col-md-9">
                        <select class="form-control" ng-model="data.app" ng-options="app.title for app in apps"></select>
                    </div>
                </div>
                <div class='form-group'>
                    <label class="col-md-3 control-label">目标分组</label>
                    <div class="col-md-9">
                        <select class="form-control" ng-model="data.round" ng-options="rnd.title for rnd in data.app.rounds">
                            <option>全部分组</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" ng-click="ok()">确定</button>
        </div>
    </script>
    <script src="/static/js/xxt.ui.error.js"></script>
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/angular.min.js"></script>
    <script src="/static/js/angular-route.min.js"></script>
    <script src="/static/js/angular-sanitize.min.js"></script>
    <script src="/static/js/ui-bootstrap-tpls.min.js"></script>
    <script src="/static/js/resumable.js"></script>
    <script src="/static/js/ui-tms.js?_=4"></script>
    <script src="/static/js/xxt.ui.js?_=4"></script>
    <script src="/views/default/pl/fe/_module/matter.service.js?_=1"></script>
    <script src="/static/js/require.js" data-main="/views/default/pl/fe/matter/enroll/shop-loader.js?_=1"></script>
</body>

</html>