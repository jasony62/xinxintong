<div class='col-md-6 col-md-offset-3'>
    <div class='panel panel-default' ng-controller="ctrlAccess">
        <div class='panel-body'>
            <div class='form-group'>
                <label>参与人进入规则 <span class='glyphicon glyphicon-question-sign' uib-tooltip='项目下创建活动时，默认设置的进入规则。' tooltip-placement='bottom'></span></label>
                <div class='radio'>
                    <label>
                        <input type='radio' value='member' ng-model="rule.scope" ng-change="changeUserScope()">限通讯录联系人访问</label>
                </div>
                <div class='radio' ng-if="snsCount>0">
                    <label>
                        <input type='radio' value='sns' ng-model="rule.scope" ng-change="changeUserScope()">限公众号关注用户访问</label>
                </div>
                <div class='radio'>
                    <label>
                        <input type='radio' value='none' ng-model="rule.scope" ng-change="changeUserScope()">不限制</label>
                </div>
            </div>
            <div ng-if="rule.scope==='member'">
                <table class='table table-bordered'>
                    <thead>
                        <tr>
                            <th>通讯录</th>
                            <th style='width:69px'>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="(msid,erm) in mission.entry_rule.member">
                            <td><span>{{mschemasById[msid]?mschemasById[msid].title:'通讯录不存在'}}</span></td>
                            <td>
                                <button class='btn btn-default btn-xs' ng-click="editMschema(mschemasById[msid])"><span class='glyphicon glyphicon-edit'></span></button>
                                <button class='btn btn-default btn-xs' ng-click="removeMschema(msid)"><span class='glyphicon glyphicon-remove'></span></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class='btn btn-default' ng-click="chooseMschema()">选择通讯录</button>
            </div>
            <div ng-if="rule.scope==='sns'&&snsCount>1">
                <table class='table table-bordered'>
                    <tbody>
                        <tr>
                            <th>公众号</th>
                            <th style='width:69px'>操作</th>
                        </tr>
                        <tr ng-if="sns.wx">
                            <td>微信公众号关注用户</td>
                            <td>
                                <label class='checkbox-inline'>
                                    <input type='checkbox' ng-true-value="'Y'" ng-false-value="" ng-change="update('entry_rule')" ng-model='mission.entry_rule.sns.wx.entry'>生效</label>
                            </td>
                        </tr>
                        <tr ng-if="sns.qy">
                            <td>微信企业号关注用户</td>
                            <td>
                                <label class='checkbox-inline'>
                                    <input type='checkbox' ng-true-value="'Y'" ng-false-value="" ng-change="update('entry_rule')" ng-model='mission.entry_rule.sns.qy.entry'>生效</label>
                            </td>
                        </tr>
                        <tr ng-if="sns.yx">
                            <td>易信公众号关注用户</td>
                            <td>
                                <label class='checkbox-inline'>
                                    <input type='checkbox' ng-true-value="'Y'" ng-false-value="" ng-change="update('entry_rule')" ng-model='mission.entry_rule.sns.yx.entry'>生效</label>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class='panel panel-default' ng-controller="ctrlRemind">
        <div class='panel-body'>
            <div class='form-group'>
                <label>参与人进入链接 <span class='glyphicon glyphicon-question-sign' uib-tooltip='参与人查看项目中所有需要参加的活动。'></span></label>
                <div class='input-group'>
                    <input class='form-control' readonly value="{{mission.entryUrl}}">
                    <div class='input-group-btn'>
                        <a class='btn btn-default' ng-href="{{mission.entryUrl}}" target='_blank' title='打开'><i class='glyphicon glyphicon-open'></i></a>
                    </div>
                </div>
            </div>
            <div class='form-group'>
                <label>接收项目定时通知的用户</label>
                <div class="input-group">
                    <input class='form-control' title="{{mission.userApp.title}}" value="{{mission.userApp.title}}" readonly="">
                    <div class="input-group-btn">
                        <button class="btn btn-default" ng-click="cancelUserApp()" ng-if="mission.userApp">
                            <span class='glyphicon glyphicon-remove'></span>
                        </button>
                        <button class='btn btn-success' ng-click="assignUserApp()" ng-if="!mission.userApp">指定</button>
                    </div>
                </div>
            </div>
            <!-- begin timers -->
            <div ng-repeat="timer in timers">
                <hr>
                <div ng-include="'/views/default/pl/fe/_module/timerNotice.html'"></div>
            </div>
            <!-- end timers -->
            <hr>
            <div>
                <button class='btn btn-default' ng-click="srvTimer.add(mission,timers,'remind')">添加定时通知规则</button>
            </div>
            <div ng-if="timers.length">
                <hr>
                <a href ng-click="switchTo('notice')">查看通知发送日志</a>
            </div>
        </div>
    </div>
    <div class='panel panel-default' ng-if="missionMschemas.length">
        <div class='panel-body'>
            <div class='form-group' ng-repeat="mschema in missionMschemas">
                <label>通讯录【{{mschema.title}}】填写链接 <span class='glyphicon glyphicon-question-sign' uib-tooltip='参与人填写通讯录信息。'></span></label>
                <div class='input-group'>
                    <input class='form-control' readonly value="{{mschema.fullUrl}}">
                    <div class='input-group-btn'>
                        <a class='btn btn-default' ng-href="{{mschema.fullUrl}}" target='_blank' title='打开'><i class='glyphicon glyphicon-open'></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class='panel panel-default' ng-controller="ctrlReport">
        <div class='panel-body'>
            <div class='form-group'>
                <label>监督人进入链接 <span class='glyphicon glyphicon-question-sign' uib-tooltip='监督人查看项目下所有活动的进展。'></span></label>
                <div class='input-group'>
                    <input class='form-control' readonly value="{{opEntry.url}}">
                    <div class='input-group-btn'>
                        <a class='btn btn-default' ng-href="{{opEntry.url}}" target='_blank' title='打开'><i class='glyphicon glyphicon-open'></i></a>
                    </div>
                </div>
            </div>
            <div class='form-group'>
                <button class='btn btn-default' ng-if="!opEntry.url" ng-click="makeOpUrl()">生成</button>
                <button class='btn btn-default' ng-if="opEntry.url" ng-click="closeOpUrl()">关闭</button>
                <button uib-popover-template="'opUrlPasswd.html'" popover-append-to-body='true' popover-placement="bottom" popover-title="访问密码" popover-trigger="outsideClick" type="button" class="btn btn-default" class='btn btn-default' ng-if="opEntry.url">密码 <span class="caret"></span></button>
            </div>
            <div class='form-group' ng-if="opEntry.url">
                <label class='checkbox-inline'>
                    <input type='checkbox' ng-true-value="'Y'" ng-false-value="'N'" ng-model="opEntry.can_favor" ng-change="updCanFavor()">支持收藏</label>
                <p class='help-block'>分享链接有效期1小时，设置【支持收藏】后，用户可收藏本链接，避免有效期限制</p>
            </div>
            <hr>
            <div>
                <div class='form-group' ng-if="sns.wx.joined==='Y'&&sns.wx.can_qrcode==='Y'">
                    <button id='wxQrcode' uib-popover-template="'joinQrcode.html'" popover-trigger="show" popover-placement="bottom" class="btn btn-default" ng-click="qrcode('wx')">微信公众号用户扫码作为接收人 <span class="caret"></span></button>
                </div>
                <div class='form-group' ng-if="sns.yx.joined==='Y'&&sns.yx.can_qrcode==='Y'">
                    <button id='yxQrcode' uib-popover-template="'joinQrcode.html'" popover-trigger="show" popover-placement="bottom" class="btn btn-default" ng-click="qrcode('yx')">易信公众号用户扫码作为接收人 <span class="caret"></span></button>
                </div>
                <div class='list-group'>
                    <div class='list-group-item' ng-repeat="r in receivers" ng-mouseenter="entered=true" ng-mouseleave="entered=false">
                        <span>{{r.nickname}}</span>&nbsp;<span ng-if="r.snsUser.snsName">{{r.snsUser.snsName}}</span>
                        <button class='btn btn-default btn-xs pull-right' ng-show="entered" ng-click="remove(r)">
                            <span class='glyphicon glyphicon-remove'></span>
                        </button>
                    </div>
                </div>
            </div>
            <!-- receiver -->
            <!-- begin timer -->
            <div ng-repeat="timer in timers">
                <hr>
                <div ng-include="'/views/default/pl/fe/_module/timerNotice.html'"></div>
            </div>
            <hr>
            <div>
                <button class='btn btn-default' ng-click="srvTimer.add(mission,timers,'report')">添加定时通知规则</button>
            </div>
            <div ng-if="timers.length">
                <hr>
                <a href ng-click="switchTo('notice')">查看通知发送日志</a>
            </div>
        </div>
        <!-- end timer -->
    </div>
    <script type="text/ng-template" id="joinQrcode.html">
        <div style="width:200px">
            <img ng-src="{{qrcodeURL}}" style="width:100%">
        </div>
    </script>
    <script type="text/ng-template" id="opUrlPasswd.html">
        <div id="opUrlPasswd">
            <div class='form-group'>
                <div class='input-group'>
                    <input class='form-control' ng-model="opEntry.password">
                    <div class='input-group-btn'>
                        <button class='btn btn-default' ng-click="configOpUrl($event,'password')">设置</button>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="assignUserApp.html">
        <div class="modal-header">
            <button class="close" type="button" ng-click="cancel()">×</button>
            <h5 class="modal-title">指定项目用户名单</h5>
        </div>
        <div class="modal-body">
            <form class="form-horizontal">
                <div class='form-group'>
                    <label class="col-md-3 control-label">活动类型</label>
                    <div class="col-md-9">
                        <label class='radio-inline'>
                            <input type='radio' value='group' ng-model="data.appType">分组活动</label>
                        <label class='radio-inline'>
                            <input type='radio' value='enroll' ng-model="data.appType">登记活动</label>
                        <label class='radio-inline'>
                            <input type='radio' value='signin' ng-model="data.appType">签到活动</label>
                        <label class='radio-inline'>
                            <input type='radio' value='mschema' ng-model="data.appType">通讯录</label>
                    </div>
                </div>
                <div class='form-group'>
                    <label class="col-md-3 control-label">目标活动</label>
                    <div class="col-md-9">
                        <select class="form-control" ng-model="data.appId" ng-options="app.id as app.title for app in apps" size=10></select>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" ng-click="ok()">确定</button>
        </div>
    </script>
</div>