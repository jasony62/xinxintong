<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <base href="/" />
    <title>签到活动——新建</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/font-awesome.min.css" rel="stylesheet">
    <link href="/static/css/tms.css?_=2" rel="stylesheet">
    <link href="<?php echo auto_version('/static/css/pl.fe.css');?>" rel="stylesheet">
</head>

<body ng-controller='ctrlPlan' ng-cloak class='ng-cloak'>
    <div class='pl-layout'>
        <!--logo+侧边栏-->
        <div class='pl-layout-leftnav'>
            <!--logo-->
            <div class='pl-layout-leftnav-header'>
                <a href='/rest/home' target='_self'>
                    <?php echo APP_TITLE;?>
                </a>
            </div>
            <!--侧边栏-->
            <ul class="nav nav-tabs nav-stacked">
            </ul>
        </div>
        <!--导航+主体内容-->
        <div class='pl-layout-main pl-layout-main-topnav'>
            <nav class="navbar pl-navbar-default pl-navbar-fixed-top">
                <div class='container-fluid'>
                    <nav class='nav navbar-nav tms-breadcrumb'>
                        <li><a href="/rest/pl/fe?view=main&scope=activity&type=signin&sid={{site.id}}" target='_self'>工作台</a></li>
                        <li ng-if="site.yourRole"><a href="/rest/pl/fe?view=main&scope=activity&type=signin&sid={{site.id}}" target='_self'>{{site.name}}</a></li>
                        <li ng-if="!site.yourRole"><a href="javascript:void(0)" style='color:#777;cursor:default;'>{{site.name}}</a></li>
                        <li ng-if="mission"><a href="/rest/pl/fe/matter/mission?site={{mission.siteid}}&id={{mission.id}}" target='_self'>{{mission.title}}</a></li>
                    </nav>
                </div>
            </nav>
            <div class='container-fluid'>
                <div class="row">
                    <div class='col-md-6 col-md-offset-3'>
                        <div class='panel panel-default'>
                            <div class='panel-body'>
                                <div class='form-group'>
                                    <label>活动名称</label>
                                    <input class='form-control' ng-model='proto.title'>
                                </div>
                                <div class='form-group'>
                                    <label>活动说明</label>
                                    <textarea class='form-control' ng-model='proto.summary'></textarea>
                                </div>
                                <div class='row'>
                                    <div class='col-md-6'>
                                        <div class='form-group'>
                                            <label>开始时间</label>
                                            <tms-datepicker class='tms-datepicker' tms-title='开始时间' tms-date='proto.start_at' tms-state='start_at'></tms-datepicker>
                                        </div>
                                    </div>
                                    <div class='col-md-6'>
                                        <div class='form-group'>
                                            <label>结束时间</label>
                                            <tms-datepicker class='tms-datepicker' tms-title='结束时间' tms-date='proto.end_at' tms-state='end_at'></tms-datepicker>
                                        </div>
                                    </div>
                                </div>
                                <div class='form-group' ng-if="proto.mission">
                                    <label>所属项目</label>
                                    <input class='form-control' title="{{proto.mission.title}}" value="{{proto.mission.title}}" readonly>
                                </div>
                                <hr>
                                <div class='form-group'>
                                    <label>参与用户</label>
                                    <div class='radio'>
                                        <label>
                                            <input type='radio' value='member' ng-model="entryRule.scope" ng-change="changeUserScope()">限通讯录联系人参与 <span class='glyphicon glyphicon-question-sign' uib-tooltip='通讯录支持自定义用户信息并提供审核机制，并且可以在不同活动中重复使用'></span> <span class='badge' ng-repeat="mschema in entryRule.mschemas">{{mschema.title}} <i class='glyphicon glyphicon-remove' ng-click="removeMschema(mschema)"></i></span> <a ng-if="entryRule.scope==='member'" href='' ng-click="chooseMschema()">添加</a></label>
                                    </div>
                                    <div class='radio' ng-if="snsNames.length===1">
                                        <label>
                                            <input type='radio' value='sns' ng-model="entryRule.scope" ng-change="changeUserScope()">限公众号【{{sns[snsNames[0]].title}}】关注用户参与 <span class='glyphicon glyphicon-question-sign' uib-tooltip='可以获得用户昵称和头像（需要用户授权）。系统持久记录填写终端和填写记录间的对应关系，适用于填写后不需要查询和修改的情况。'></span></label>
                                    </div>
                                    <div class='radio' ng-if="snsNames.length>1">
                                        <label>
                                            <input type='radio' value='sns' ng-model="entryRule.scope" ng-change="changeUserScope()">限公众号关注用户参与 <span class='glyphicon glyphicon-question-sign' uib-tooltip='可以获得用户昵称和头像（需要用户授权）。系统持久记录填写终端和填写记录间的对应关系，适用于填写后不需要查询和修改的情况。'></span>
                                            <span ng-if="entryRule.scope==='sns'">
                                                        <label ng-repeat="snsName in snsNames">
                                                            <input type='checkbox' ng-model="entryRule.sns[snsName]"> {{sns[snsName].title}} </label>
                                                        </span>
                                        </label>
                                    </div>
                                    <div class='radio'>
                                        <label>
                                            <input type='radio' value='none' ng-model="entryRule.scope">不限制 <span class='glyphicon glyphicon-question-sign' uib-tooltip='用户可以使用手机、PC机上的微信或浏览器等终端参与活动，系统不持久记录填写终端和填写记录间的对应关系，适用于填写后不需要查询和修改的情况'></span></label>
                                    </div>
                                </div>
                                <hr>
                                <div class='form-group' ng-if="!proto.groupApp">
                                    <button class='btn btn-default btn-block' ng-disabled="!proto.mission" ng-click="assignGroupApp()">指定分组匹配名单 <span class='glyphicon glyphicon-question-sign' uib-tooltip='指定同一个项目中的分组活动后，用户填写数据时需要提供和分组活动中匹配分组信息，例如：组号等，系统支持按照分组提交记录进行筛选和记分等功能'></span></button>
                                </div>
                                <div class='form-group' ng-if="proto.groupApp">
                                    <label>分组匹配名单</label>
                                    <div class="input-group">
                                        <input class='form-control' title="{{proto.groupApp.title}}" value="{{proto.groupApp.title}}" readonly>
                                        <div class="input-group-btn">
                                            <button class="btn btn-default" ng-click="proto.groupApp=null">
                                                <span class='glyphicon glyphicon-remove'></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class='form-group'>
                            <button class="btn btn-success btn-block" ng-click="doCreate()"><span class='glyphicon glyphicon-plus'></span> 确定创建签到活动</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/static/js/xxt.ui.error.js"></script>
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/angular.min.js"></script>
    <script src="/static/js/angular-route.min.js"></script>
    <script src="/static/js/angular-sanitize.min.js"></script>
    <script src="/static/js/ui-bootstrap-tpls.min.js"></script>
    <script src="/static/js/ui-tms.js?_=4"></script>
    <script src="<?php echo auto_version('/asset/js/xxt.ui.http.js');?>"></script>
    <script src="<?php echo auto_version('/asset/js/xxt.ui.notice.js');?>"></script>
    <script src="<?php echo auto_version('/views/default/pl/fe/_module/matter.service.js');?>"></script>
    <script src="/static/js/require.js" data-main="/views/default/pl/fe/matter/signin/plan-loader.js?_=1"></script>
</body>

</html>